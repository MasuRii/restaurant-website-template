---
import type { ImageMetadata } from 'astro';
import { Image, getImage } from 'astro:assets';

interface Props {
  src: ImageMetadata;
  alt: string;
  class?: string;
  loading?: 'lazy' | 'eager';
  sizes?: string;
  width?: number;
  height?: number;
}

const { 
  src, 
  alt, 
  class: className = '', 
  loading = 'lazy', 
  sizes = '(min-width: 1024px) 100vw, 100vw',
  width,
  height
} = Astro.props;

// Generate low-res placeholder (20px width)
const placeholder = await getImage({
  src,
  width: 20,
  format: 'webp',
  quality: 50,
});

const placeholderStyle = `background-image: url('${placeholder.src}'); background-size: cover; background-position: center;`;
---

<div class={`relative overflow-hidden bg-stone-200 ${className}`} style={placeholderStyle}>
  {/* Blur layer */}
  <div 
    class="absolute inset-0 backdrop-blur-xl scale-110 transition-opacity duration-700 pointer-events-none z-10"
    aria-hidden="true"
  ></div>
  
  {/* Main Image */}
  <Image
    src={src}
    alt={alt}
    width={width || src.width}
    height={height || src.height}
    widths={[640, 768, 1024, 1280, 1536, 1920]}
    sizes={sizes}
    loading={loading}
    format="avif"
    class="w-full h-full object-cover relative z-20 opacity-0 transition-opacity duration-500"
    onload="this.classList.remove('opacity-0'); this.previousElementSibling.classList.add('opacity-0');"
  />
</div>
