---
import { useTranslations } from '../lib/i18n';

const t = useTranslations(Astro.currentLocale || 'en');
---

<a
  id="floating-cta"
  href="#reservations"
  class="fixed z-40 bottom-6 right-6 md:bottom-8 md:right-8 bg-primary text-alabaster px-6 py-3 rounded-full shadow-lg font-serif font-medium hover:-translate-y-1 transition-all duration-300 opacity-0 pointer-events-none translate-y-4 data-[visible=true]:opacity-100 data-[visible=true]:translate-y-0 data-[visible=true]:pointer-events-auto flex items-center gap-2 group focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
  aria-label={t('cta.reserve')}
>
  <span>{t('cta.reserve')}</span>
  <svg 
    xmlns="http://www.w3.org/2000/svg" 
    width="16" 
    height="16" 
    viewBox="0 0 24 24" 
    fill="none" 
    stroke="currentColor" 
    stroke-width="2" 
    stroke-linecap="round" 
    stroke-linejoin="round" 
    class="w-4 h-4 group-hover:translate-x-0.5 transition-transform"
  >
    <path d="M5 12h14"></path>
    <path d="m12 5 7 7-7 7"></path>
  </svg>
</a>

<script>
  const floatingCta = document.getElementById('floating-cta');
  const hero = document.getElementById('hero');

  if (floatingCta && hero) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          // Show CTA when hero is NOT intersecting (scrolled past)
          if (!entry.isIntersecting) {
            floatingCta.setAttribute('data-visible', 'true');
            floatingCta.setAttribute('aria-hidden', 'false');
          } else {
            floatingCta.setAttribute('data-visible', 'false');
            floatingCta.setAttribute('aria-hidden', 'true');
          }
        });
      },
      {
        threshold: 0.1, // Trigger when even a small part of hero is visible (or rather, when it leaves)
        rootMargin: '-100px 0px 0px 0px' // Offset to trigger slightly before/after
      }
    );

    observer.observe(hero);
  }
</script>
